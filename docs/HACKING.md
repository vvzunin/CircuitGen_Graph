## Режим разработчика

Цели системы сборки, которые полезны для разработчиков этого проекта, скрыты, если опция `CircuitGen_Graph_DEVELOPER_MODE` отключена. При ее включении становятся доступны результаты и покрытие тестов, а также некоторые другие цели и параметры. 

Режим разработчика всегда включен в рабочих процессах CI.

### Правила при разработке

Исходный код проекта должен соответствовать условиям, изложенным в [CODESTYLE.md](../docs/CODESTYLE.md)

### Пресеты

В этом проекте используются [пресеты][1] для упрощения процесса настройки проекта. При разработке рекомендуется всегда устанавливать [последнюю версию CMake][2].

У вас есть несколько вариантов передачи `CircuitGen_Graph_DEVELOPER_MODE` в команду настройки, но в этом проекте предпочитают использовать пресеты.

Нужно создать файл `CMakeUserPresets.json` в корне проекта:

```json
{
  "version": 2,
  "cmakeMinimumRequired": {
    "major": 3,
    "minor": 14,
    "patch": 0
  },
  "configurePresets": [
    {
      "name": "dev",
      "binaryDir": "${sourceDir}/build/dev",
      "inherits": ["dev-mode", "ci-linux"],
      "cacheVariables": {
        "CMAKE_BUILD_TYPE": "Debug"
      }
    }
  ],
  "buildPresets": [
    {
      "name": "dev",
      "configurePreset": "dev",
      "configuration": "Debug"
    }
  ],
  "testPresets": [
    {
      "name": "dev",
      "configurePreset": "dev",
      "configuration": "Debug",
      "output": {
        "outputOnFailure": true
      }
    }
  ]
}
```

Вам следует заменить `<os>` в новом файле настроек на тип вашей операционной системы, к примеру `win64`, `linux` или `darwin`. Вы можете увидеть, чему они соответствуют, в файле [`CMakePresets.json`](../CMakePresets.json).

`CMakeUserPresets.json` является местом, куда вы можете поместить все, что в противном случае вы передавали бы команде configure в терминале.

> **Примечание**
> Некоторые редакторы довольно жадны в открытии проектов с пресетами.
> Иногда пресет выбирается случайно и настройка происходит без вашего контроля.
> Убедитесь, что ваша сборка настраивается, так как вам этого хочется,
> например, в CLion Вам нужно убедиться, что только в `dev-dev preset` установлен
> флажок `Включить профиль > Файл > Настройки... > Сборка, выполнение, развертывание >`
> `Файл > Настройки... > Сборка, выполнение, развертывание > CMake` и в Visual Studio
> Вам необходимо установить опцию «Никогда не запускать шаг настройки автоматически»
> в `Инструменты > Параметры > CMake` **до открытия проекта**, после чего
> Вы можете настроить сборку вручную.

### Настройка, сборка и тестирование

Если Вы следовали приведенным инструкциям, то Вы можете настроить, собрать и протестировать проект соответственно с помощью следующих команд из корня проекта в любой операционной системе с любой системой сборки:

```sh
cmake --preset=dev
cmake --build --preset=dev
ctest --preset=dev
```

Если вы используете совместимый редактор (например, VSCode) или IDE (например, CLion, VS), вы также сможете выбрать созданные пользовательские пресеты для автоматической интеграции.

И команды сборки, и команды тестирования принимают флаг `-j` для указания количества заданий, которое в идеале должно быть указано в соответствии с количеством потоков вашего процессора. Вы можете добавить это в свой пресет, используя свойство `jobs`, подробную информацию можно найти в [документации по пресетам][1].

Чтобы запустить конкретный тест, перейдите в папку build/dev/test, и в ней выполните
```
ctest -R FirstTestName.SecondTestName --verbose
```
### Цели режима разработчика

Это цели, которые вы можете вызвать с помощью приведенной выше команды сборки с флагом `-t <target>`:

#### `coverage`

Доступно, если включен `ENABLE_COVERAGE`. Эта цель обрабатывает выходные данные ранее запущенных тестов и строит покрытие. Команды, которые выполняет эта цель, можно найти в переменных `COVERAGE_TRACE_COMMAND` и `COVERAGE_HTML_COMMAND`. Команда трассировки по умолчанию создает информационный файл, который можно отправить в службы с интеграцией CI. Команда HTML использует выходные данные команды трассировки для создания HTML-документа в `<binary-dir>/coverage_html` по умолчанию.

Готовый набор команд для сборки с покрытием можно выполнить с помощью скрипта [codecov_build.sh](../codecov_build.sh)
#### `docs`

Доступно, если включен `BUILD_MCSS_DOCS`. Сборка документации с использованием Doxygen и m.css. По умолчанию вывод будет идти в `<binary-dir>/docs` (настраивается с помощью `DOXYGEN_OUTPUT_DIRECTORY`).

#### `format-check` и `format-fix`

Эти цели запускают инструмент формата clang в базе кода для проверки ошибок и их исправления соответственно. Доступна настройка с использованием переменных `FORMAT_PATTERNS` и `FORMAT_COMMAND`.

#### `spell-check` и `spell-fix`

Эти цели запускают инструмент кодирования в базе кода для проверки ошибок и их исправления соответственно. Доступна настройка с использованием переменной `SPELL_COMMAND`.

[1]: https://cmake.org/cmake/help/latest/manual/cmake-presets.7.html
[2]: https://cmake.org/download/


